<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>BlockChain</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="wallet.html"><strong aria-hidden="true">1.</strong> 钱包</a></li><li class="chapter-item expanded "><a href="substrate/index.html"><strong aria-hidden="true">2.</strong> Substrate</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="substrate/arch.html"><strong aria-hidden="true">2.1.</strong> 架构</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">BlockChain</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="钱包"><a class="header" href="#钱包">钱包</a></h1>
<p>钱包只存储私钥，不存储币, 币都在链上。</p>
<p>根据钱包包含的多个密钥之间是否有关系，主要分为两种类型：</p>
<ul>
<li>第一种类型是<strong>非确定性钱包（nondeterministic wallet）</strong>，其中每个密钥都是从随机数独立生成的，密钥彼此无关。这种钱包也被称为“Just a Bunch Of Keys（一堆密钥）”，简称 JBOK 钱包。</li>
<li>第二种类型是<strong>确定性钱包（deterministic wallet）</strong>，其中所有的密钥都是从一个主密钥派生出来，这个主密钥即为种子（seed）。该类型钱包中所有密钥都相互关联，如果有原始种子，则可以再次生成全部密钥。确定性钱包中使用了许多不同的密钥推导方法。最常用的推导方法是使用树状结构，称为<strong>分层确定性（hierarchical deterministic）钱包或 HD 钱包</strong>。</li>
</ul>
<p>相比随机（不确定性）密钥，HD 钱包有两个主要的优势。第一，树状结构可以被用来表达附加的组织含义，比如子密钥的特定分支用来接收交易收入款项，另一个分支用来负责接收对外付款的找零。密钥的分支也可以用于公司设置，将不同的分支分配给部门、子公司、特定功能或会计类别。
HD 钱包的第二个好处是，用户可以创建一系列公钥，而不需要访问对应的私钥。这样，HD 钱包就能用在不安全的服务器上，或者仅作为接收用途，它为每个交易发布不同的公钥。公钥不需要被预先加载或者提前衍生，服务器也不需要有用来支付的私钥。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="substrate"><a class="header" href="#substrate">Substrate</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="一architecture"><a class="header" href="#一architecture">一、Architecture</a></h1>
<h2 id="11-storage"><a class="header" href="#11-storage">1.1 Storage</a></h2>
<ul>
<li>rocksdb: kv store</li>
</ul>
<h2 id="12-runtime"><a class="header" href="#12-runtime">1.2 Runtime</a></h2>
<ul>
<li>Wasm</li>
</ul>
<h2 id="13-peer-to-peer-network"><a class="header" href="#13-peer-to-peer-network">1.3 Peer-to-peer network</a></h2>
<ul>
<li><a href="https://libp2p.io/">libp2p</a></li>
</ul>
<h2 id="14-consensus"><a class="header" href="#14-consensus">1.4 Consensus</a></h2>
<ul>
<li>POW: <code>ethash</code></li>
<li>POS: <code>Aure</code>、<code>BABE</code></li>
</ul>
<h2 id="15-rpc"><a class="header" href="#15-rpc">1.5 RPC</a></h2>
<ul>
<li>jsonRPC</li>
</ul>
<h2 id="16-telemetry"><a class="header" href="#16-telemetry">1.6 Telemetry</a></h2>
<h2 id="17-state"><a class="header" href="#17-state">1.7 State</a></h2>
<ul>
<li>Tire(Patricia Merkle Tree) structure</li>
</ul>
<h1 id="二key-concept"><a class="header" href="#二key-concept">二、Key Concept</a></h1>
<h2 id="21-runtime"><a class="header" href="#21-runtime">2.1 Runtime</a></h2>
<h3 id="211-api"><a class="header" href="#211-api">2.1.1 API</a></h3>
<ul>
<li><strong><code>BlockBuilder</code></strong>: Provides the functionality required for building a block.</li>
<li><strong><code>TaggedTransactionQueue</code></strong>: Handles validating transactions in the transaction queue.</li>
<li><strong><code>OffchainWorkerApi</code></strong>: Handles off-chain capabilities.</li>
<li><strong><code>AuraApi</code></strong>: Handles block authorship with Aura consensus.</li>
<li><strong><code>SessionKeys</code></strong>: Generates and decodes session keys.</li>
<li><strong><code>GrandpaApi</code></strong>: Integrates the GRANDPA finality gadget into the runtime.</li>
<li><strong><code>AccountNonceApi</code></strong>: Handles querying transaction indices.</li>
<li><strong><code>TransactionPaymentApi</code></strong>: Handles querying information about transactions.</li>
<li><strong><code>Benchmark</code></strong>: Provides a way to benchmark a FRAME runtime.</li>
</ul>
<h3 id="212-core-primitives"><a class="header" href="#212-core-primitives">2.1.2 Core primitives</a></h3>
<ul>
<li><strong><code>Hash</code></strong>: A type which encodes a cryptographic digest of some data. Typically just a 256-bit quantity.</li>
<li><strong><code>DigestItem</code></strong>: A type which must be able to encode one of a number of &quot;hard-wired&quot; alternatives relevant to consensus and change-tracking as well as any number of &quot;soft-coded&quot; variants, relevant to specific modules within the runtime.</li>
<li><strong><code>Digest</code></strong>: A series of DigestItems. This encodes all information that is relevant for a light-client to have on hand within the block.</li>
<li><strong><code>Extrinsic</code></strong>: A type to represent a single piece of data external to the blockchain that is recognized by the blockchain. This typically involves one or more signatures, and some sort of encoded instructions (e.g. for transferring ownership of funds or calling into a smart contract).</li>
<li><strong><code>Header</code></strong>: A type which is representative (cryptographically or otherwise) of all information relevant to a block. It includes the parent hash, the storage root and the extrinsics trie root, the digest and a block number.</li>
<li><strong><code>Block</code></strong>: Essentially just a combination of <code>Header</code> and a series of <code>Extrinsics</code>, together with a specification of the hashing algorithm to be used.</li>
<li><strong><code>BlockNumber</code></strong>: A type which encodes the total number of ancestors any valid block has. Typically a 32-bit quantity. </li>
</ul>
<h3 id="213-frame-primitives"><a class="header" href="#213-frame-primitives">2.1.3 FRAME primitives</a></h3>
<p><img src="substrate/./_assets/frame-runtime.png" alt="frame-runtime" /></p>
<h4 id="additional-set-of-primitives"><a class="header" href="#additional-set-of-primitives">additional set of primitives</a></h4>
<ul>
<li><strong><code>Call</code></strong>: The dispatch type that can be called via an extrinsic.</li>
<li><strong><code>Origin</code></strong>: Represents where a call came from. For example, a signed message (a transaction), an unsigned message (an inherent extrinsic), or a call from the runtime itself (a root call).</li>
<li><strong><code>Index</code></strong>: An account index (aka nonce) type. This stores the number of previous transactions associated with a sender account.</li>
<li><strong><code>Hashing</code></strong>: The hashing algorithm being used in the runtime (e.g. Blake2).</li>
<li><strong><code>AccountId</code></strong>: The type used to identify user accounts in the runtime.</li>
<li><strong><code>Event</code></strong>: The type used for events emitted by the runtime.</li>
<li><strong><code>Version</code></strong>: A type which represents the version of the runtime.</li>
</ul>
<h2 id="22-extrinsic"><a class="header" href="#22-extrinsic">2.2 Extrinsic</a></h2>
<h3 id="221-block-structure"><a class="header" href="#221-block-structure">2.2.1 Block structure</a></h3>
<p>A block in Substrate is composed of a <code>header</code> and an array of <code>extrinsics</code>. </p>
<ul>
<li>The header contains a <code>block height</code>, <code>parent hash</code>, <code>extrinsics root</code>, <code>state root</code>, and <code>digest</code>. This section will only focus on the extrinsics root.</li>
<li>Extrinsics are bundled together into a block as a series to be executed as each is defined in the runtime. The extrinsics root is a cryptographic digest of this series. This serves two purposes. 
<ul>
<li>First, it prevents any alterations to the series of extrinsics after the header has been built and distributed. </li>
<li>Second, it provides a means of allowing light clients to succinctly verify that any given extrinsic did indeed exist in a block given only knowledge of the header.</li>
</ul>
</li>
</ul>
<h3 id="222-inherents"><a class="header" href="#222-inherents">2.2.2 Inherents</a></h3>
<h3 id="223-signed-transactions"><a class="header" href="#223-signed-transactions">2.2.3 Signed transactions</a></h3>
<h3 id="224-unsigned-transactions"><a class="header" href="#224-unsigned-transactions">2.2.4 Unsigned transactions</a></h3>
<h2 id="23-account-abstractions"><a class="header" href="#23-account-abstractions">2.3 Account Abstractions</a></h2>
<p>Substrate uses multiple sets of public/private key pairs to represent participants of the network, including <code>validators</code>, <code>nominators</code> and <code>normal users</code>.</p>
<ul>
<li><strong><code>Stash Key</code></strong>: a Stash account is meant to hold large amounts of funds. Its private key should be as secure as possible in a cold wallet.</li>
<li><strong><code>Controller Key</code></strong>: a Controller account signals choices on behalf of the Stash account, like payout preferences, but should only hold a minimal amount of funds to pay transaction fees. Its private key should be secure as it can affect validator settings, but will be used somewhat regularly for validator maintenance.</li>
<li><strong><code>Session Keys</code></strong>: these are &quot;hot&quot; keys kept in the validator client and used for signing certain validator operations. They should never hold funds.</li>
</ul>
<h2 id="24-transaction"><a class="header" href="#24-transaction">2.4 Transaction</a></h2>
<p>The transaction pool contains all transactions (<code>signed</code> and <code>unsigned</code>) broadcasted to the network that have been received and validated by the local node.</p>
<h3 id="241-validity"><a class="header" href="#241-validity">2.4.1 Validity</a></h3>
<p>The transaction pool checks for transaction validity. 
Example validity checks are:</p>
<ul>
<li>Checking if the Transaction Index (nonce) is correct.</li>
<li>Checking if the account has enough funds to pay for the associated fees.</li>
<li>Checking if the signature is valid.</li>
</ul>
<h3 id="242-sorting"><a class="header" href="#242-sorting">2.4.2 Sorting</a></h3>
<p>If the transaction is valid, the transaction queue sorts transactions into two groups:</p>
<ul>
<li><strong><code>Ready Queue</code></strong>  Contains transactions that can be included in a new pending block. For runtimes built with FRAME, the transactions must follow the exact order in the ready queue.</li>
<li><strong><code>Future Queue</code></strong>  Contains transactions that may become valid in the future. For example, a transaction may have a nonce that is too high for its account. This transaction will wait in the future queue until the preceding transactions are included in the chain.</li>
</ul>
<h3 id="243-transaction-dependencies"><a class="header" href="#243-transaction-dependencies">2.4.3 Transaction dependencies</a></h3>
<p>The ValidTransaction struct defines the <code>requires</code> and <code>provides</code> parameters to build a dependency graph of transactions. Together with <code>priority</code> (discussed below), this dependency graph allows the pool to produce a valid linear ordering of transactions.</p>
<p>At minimum, FRAME transactions have a provides tag of <code>encode(sender ++ nonce)</code> and a requires tag of <code>encode(sender ++ (nonce -1)) if nonce &gt; 0</code>. Transactions do not require anything if <code>nonce=0</code>. As a result, all transactions coming from a single sender will form a sequence in which they should be included.</p>
<h3 id="244"><a class="header" href="#244">2.4.4</a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:64004/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
